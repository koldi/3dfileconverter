#include "catch2.hpp"
#include "OBJParser.h"
#include "Material.h"
#include <vector>

std::string minimalOBJFileData = R"(
v 1.000000 -1.000000 -1.000000
v 1.000000 -1.000000 1.000000
v -1.000000 -1.000000 1.000000
v -1.000000 -1.000000 -1.000000
vt 1.0000 1.0000
vt -1.0000 1.0000
vn 0.0000 -1.0000 0.0000
vn 0.0000 1.0000 0.0000
vn 1.0000 0.0000 0.0000
vn -0.0000 -0.0000 1.0000
usemtl Material
f 1 2 3 4
f 1/1 2/2 3/1 4/2
f 1/1/1 2/2/2 3/1/3 4/2/4
f 1//1 2//2 3//3 4//4
)";

std::vector<Face> materialFaces = {{{ {1.000000, -1.000000, -1.000000}, {}, {} },
{ {1.000000, -1.000000, 1.000000}, {}, {} },
{ {-1.000000, -1.000000, 1.000000}, {}, {} },
{ {-1.000000, -1.000000, -1.000000}, {}, {} }},

{{ {1.000000, -1.000000, -1.000000}, {1.0000, 1.0000}, {} },
{ {1.000000, -1.000000, 1.000000}, {-1.0000, 1.0000}, {} },
{ {-1.000000, -1.000000, 1.000000}, {1.0000, 1.0000}, {} },
{ {-1.000000, -1.000000, -1.000000}, {-1.0000, 1.0000}, {} }},

{{ {1.000000, -1.000000, -1.000000}, {1.0000, 1.0000}, {0.0000, -1.0000, 0.0000} },
{ {1.000000, -1.000000, 1.000000}, {-1.0000, 1.0000}, {0.0000, 1.0000, 0.0000} },
{ {-1.000000, -1.000000, 1.000000}, {1.0000, 1.0000}, {1.0000, 0.0000, 0.0000} },
{ {-1.000000, -1.000000, -1.000000}, {-1.0000, 1.0000}, {-0.0000, -0.0000, 1.0000} }},

{{ {1.000000, -1.000000, -1.000000}, {}, {0.0000, -1.0000, 0.0000} },
{ {1.000000, -1.000000, 1.000000}, {}, {0.0000, 1.0000, 0.0000} },
{ {-1.000000, -1.000000, 1.000000}, {}, {1.0000, 0.0000, 0.0000} },
{ {-1.000000, -1.000000, -1.000000}, {}, {-0.0000, -0.0000, 1.0000} }}};

std::string minimalOBJFileDataWithNegativeIndex = R"(
v 1.000000 -1.000000 -1.000000
v 1.000000 -1.000000 1.000000
v -1.000000 -1.000000 1.000000
v -1.000000 -1.000000 -1.000000
vt 1.0000 1.0000
vt -1.0000 1.0000
vn 0.0000 -1.0000 0.0000
vn 0.0000 1.0000 0.0000
vn 1.0000 0.0000 0.0000
vn -0.0000 -0.0000 1.0000
usemtl Material
f -1/-1/-1 -2/-2/-2 -3/-1/-3 -4/-2/-4)";

std::vector<Face> negativeFaces = 
{{{ {-1.000000, -1.000000, -1.000000}, {-1.0000, 1.0000}, {-0.0000, -0.0000, 1.0000} },
{ {-1.000000, -1.000000, 1.000000}, {1.0000, 1.0000}, {1.0000, 0.0000, 0.0000} },
{ {1.000000, -1.000000, 1.000000}, {-1.0000, 1.0000}, {0.0000, 1.0000, 0.0000} },
{ {1.000000, -1.000000, -1.000000}, {1.0000, 1.0000}, {0.0000, -1.0000, 0.0000} }}};

std::string validOBJFileData = R"(# List of geometric vertices, with (x, y, z [,w]) coordinates, w is optional and defaults to 1.0.
v 1.000000 -1.000000 -1.000000
v 1.000000 -1.000000 1.000000
v -1.000000 -1.000000 1.000000
v -1.000000 -1.000000 -1.000000
v 1.000000 -1.000000 -1.000000
v 1.000000 -1.000000 1.000000
v -1.000000 -1.000000 1.000000
v -1.000000 -1.000000 -1.000000
# List of texture coordinates, in (u, v [,w]) coordinates, these will vary between 0 and 1, w is optional and defaults to 0.
vt 0.100 1 [0]
vt 0.200 0.234
vt 0.300 0.12 [0]
vt 0.400 0.567 [0]
vt 0.500 0.44
# List of vertex normals in (x,y,z) form; normals might not be unit vectors.
vn 0.0000 -1.0000 0.0000
vn 0.0000 1.0000 0.0000
vn 1.0000 0.0000 0.0000
vn -0.0000 -0.0000 1.0000
vn 0.0000 -1.0000 0.0000
vn 0.0000 1.0000 0.0000
# Polygonal face element (see below)
f 1 2 3
f 3/1 4/2 5/3
f 6/4/1 3/5/3 7/3/5
f 7//1 8//2 7//3)";

std::string minimalWithMultipleObjects = R"(
v 1.000000 -1.000000 -1.000000
v 1.000000 -1.000000 1.000000
v -1.000000 -1.000000 1.000000
v -1.000000 -1.000000 -1.000000
vt 1.0000 1.0000
vt -1.0000 1.0000
vn 0.0000 -1.0000 0.0000
vn 0.0000 1.0000 0.0000
vn 1.0000 0.0000 0.0000
vn -0.0000 -0.0000 1.0000
usemtl Material1
f 1 2 3 4
f 1/1 2/2 3/1 4/2
f 1/1/1 2/2/2 3/1/3 4/2/4
f 1//1 2//2 3//3 4//4
v 1.000000 -1.000000 -1.000000
v 1.000000 -1.000000 1.000000
v -1.000000 -1.000000 1.000000
v -1.000000 -1.000000 -1.000000
vt 1.0000 1.0000
vt -1.0000 1.0000
vn 0.0000 -1.0000 0.0000
vn 0.0000 1.0000 0.0000
vn 1.0000 0.0000 0.0000
vn -0.0000 -0.0000 1.0000
usemtl Material2
f 5 6 7 8
f 5/3 6/4 7/3 8/4
f 5/3/5 6/4/6 7/3/7 8/4/8
f 5//5 6//6 7//7 8//8
v 1.000000 -1.000000 -1.000000
v 1.000000 -1.000000 1.000000
v -1.000000 -1.000000 1.000000
v -1.000000 -1.000000 -1.000000
vt 1.0000 1.0000
vt -1.0000 1.0000
vn 0.0000 -1.0000 0.0000
vn 0.0000 1.0000 0.0000
vn 1.0000 0.0000 0.0000
vn -0.0000 -0.0000 1.0000
usemtl Material3
f 9 10 11 12
f 9/5 10/6 11/5 12/6
f 9/5/9 10/6/10 11/5/11 12/6/12
f 9//9 10//10 11//11 12//12)";


TEST_CASE("OBJ Data Parser", "[parser]")
{
    OBJParser parser;
    SECTION( " minimal data object " ) 
    {
        auto material = parser.FromData(minimalOBJFileData);
        std::vector<Material> expected = {{"Material", materialFaces}};
        REQUIRE(material == expected);
    }
    SECTION( " minimal data object with negative index" ) 
    {
        auto material = parser.FromData(minimalOBJFileDataWithNegativeIndex);
        std::vector<Material> expected = {{"Material", negativeFaces}};
        REQUIRE(material == expected);
    }
    SECTION( " minimal data with multiple object" ) 
    {
        auto material = parser.FromData(minimalWithMultipleObjects);
        std::vector<Material> expected = {{"Material1", materialFaces}, {"Material2", materialFaces},{"Material3", materialFaces}};
        REQUIRE(material == expected);
    }
}

